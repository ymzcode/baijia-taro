var lpad=require("../function/lpad"),classData=require("../data/class"),serverData=require("../data/server"),switchServer=require("../function/switchServer"),eventEmitter=require("../eventEmitter");exports.activeUplinkServer,exports.activeDownlinkServer,exports.init=function(){exports.downlinkServerList=serverData.getLiveServerList(),eventEmitter.on(eventEmitter.CLASSROOM_EXIT_TRIGGER,function(){exports.activeDownlinkServer=null})},exports.getUplinkStreamName=function(e){return"rtmp://"+exports.getActiveUplinkServer()+"/mgclient/"+classData.getClassId()+"-"+e.id+"000"+(e.publishIndex+1)},exports.getUplinkStreamNamePattern=function(){return/^(\w+)-(\w+)(\d{3})[0|1]$/},exports.getDownlinkStreamName=function(e,t){var r=wx.getSystemInfoSync(),n=r.model.toLowerCase();return n.indexOf("win")>-1||"windows"==r.platform||n.indexOf("mac")>-1?"https://":"rtmp://"+exports.getActiveDownlinkServer().pull+"/mgclient/"+classData.getClassId()+"-"+e+lpad(t,3)+"1"},exports.getDownlinkAudioMixedStreamName=function(e,t){var r=wx.getSystemInfoSync(),n=r.model.toLowerCase();return n.indexOf("win")>-1||"windows"==r.platform||n.indexOf("mac")>-1?"https://"+exports.getActiveDownlinkServer().ip+"/mgclient/"+classData.getClassId()+"-"+(+e+2)+lpad(t,3)+"0.flv":"rtmp://"+exports.getActiveDownlinkServer().ip+"/mgclient/"+classData.getClassId()+"-"+(+e+2)+lpad(t,3)+"0"},exports.getDownlinkWebRTCMixedStreamName=function(){var e=wx.getSystemInfoSync(),t=e.model.toLowerCase();return t.indexOf("win")>-1||"windows"==e.platform||t.indexOf("mac")>-1?"https://"+exports.getActiveDownlinkServer().pull+"/mgclient/"+classData.getClassId()+"-webrtc-mixstreams.flv":"rtmp://"+exports.getActiveDownlinkServer().pull+"/mgclient/"+classData.getClassId()+"-webrtc-mixstreams"},exports.getDownlinkStreamNamePattern=function(){return/^(\w+)-(\w+)(\d{3})[0|1](?:\?only-audio=1)?$/},exports.getActiveUplinkServer=function(){return exports.activeUplinkServer||exports.uplinkServerList[0]},exports.setActiveUplinkServer=function(e){exports.activeUplinkServer=e},exports.getActiveDownlinkServer=function(){return exports.activeDownlinkServer||exports.downlinkServerList[0]},exports.setActiveDownlinkServer=function(e){exports.activeDownlinkServer=e},exports.switchUplinkServer=function(e,t){return exports.setActiveUplinkServer(switchServer(exports.uplinkServerList,e,t)),exports.getActiveUplinkServer()},exports.switchDownlinkServer=function(e,t){return exports.setActiveDownlinkServer(switchServer(exports.downlinkServerList,e,t)),exports.getActiveDownlinkServer()};