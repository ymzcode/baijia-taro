var eventEmitter=require("./eventEmitter"),roomServer=require("./server/room"),live=require("./server/live"),store=require("./store"),$=require("./jquery");exports.messageTypes={logout:function(e,r){eventEmitter.trigger(eventEmitter.KICK_OUT)},runtime_info_req:function(e,r){store.get("partner");wx.getSystemInfo({success:function(r){var t=r;t.activeDownlinkServer=live.getActiveDownlinkServer(),exports.send(e,{name:"runtime_info_res",params:{runtime_info:t}})}})}},exports.send=function(e,r){var t=r.name,n=r.params;r={command_type:t},$.extend(r,n),roomServer.sendCommand(e,r)},exports.init=function(){eventEmitter.on(eventEmitter.COMMAND_SEND,function(e,r){exports.send(r.to,r)}).on(eventEmitter.COMMAND_RECEIVE,function(e,r){var t=r.fromId,n=r.command,o=exports.messageTypes[n.command_type];o&&o(t,n)}).on(eventEmitter.KICK_OUT_TRIGGER,function(e,r){exports.send(r.userId,{name:"logout"})})};