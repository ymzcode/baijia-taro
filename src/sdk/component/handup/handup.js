var classData=require("../../data/class"),userSpeak=require("../../userSpeak"),info=require("../../info"),auth=require("../../auth"),store=require("../../store"),$=require("../../jquery"),language=require("../../language/main")(),eventEmitter=require("../../eventEmitter"),config=require("../../config");function checkClassStarted(){var e=classData.isStarted();return e||info.tip(language.INFO_CAN_NOT_DO_BEFORE_START_CLASS),e}Component({properties:{},data:{canApplySpeak:!1,wrapperClass:"",statusConfig:{NOT_HANDUP:1,WAITING_RES:2,SPEAKING:3},status:1},ready:function(){this.bindEvent()},methods:{bindEvent:function(){var e=this,t=e.data.statusConfig;eventEmitter.on(eventEmitter.VIEW_RENDER_TRIGGER,function(){e.setData({canApplySpeak:auth.canApplySpeak()});var t=store.get("user");userSpeak.stopSpeak(t.id)}).on(eventEmitter.MEDIA_PUBLISH,function(a,n){var r=n.user;auth.isSelf(n.user.id)&&(r.videoOn||r.audioOn?e.setData({status:t.SPEAKING}):e.setData({status:t.NOT_HANDUP,wrapperClass:""}))}).on(eventEmitter.SPEAK_APPLY_RESULT_TIMEOUT,function(){info.tip(language.INFO_SPEAK_APPLY_TIMEOUT),e.setData({status:t.NOT_HANDUP,wrapperClass:""})}).on(eventEmitter.SPEAK_APPLY_RESULT_ACCEPT,function(){info.tip(language.INFO_SPEAK_APPLY_ACCEPT),e.triggerEvent("speakApplyAccect",{user:store.get("user")})}).on(eventEmitter.SPEAK_APPLY_RESULT_REJECT,function(){info.tip(language.INFO_SPEAK_APPLY_REJECT),e.setData({status:t.NOT_HANDUP,wrapperClass:""}),e.triggerEvent("speakApplyReject",{user:store.get("user")})}).on(eventEmitter.SPEAK_INVITE_RES_TRIGGER,function(a,n){n.accept&&n.force&&e.setData({status:t.SPEAKING})}).on(eventEmitter.SPEAK_APPLY_DENY,function(t,a){info.tip(language.SERVER_CONCURRENCY_REJECT),e.cancelHandup()}).on(eventEmitter.PAGE_HIDE,function(e,t){eventEmitter.trigger(eventEmitter.SPEAK_STOP_TRIGGER)})},handleApply:function(){if(classData.getForbidSpeakApply())return info(language.INFO_TEACHER_FORBID_RAISE_HAND),!1;if(auth.isSpeakingDisabled())return info(store.get("partner.disableSpeakingRequestReason")),!1;if(auth.canApplySpeak()&&checkClassStarted()){var e=store.get("partner.liveRaiseHandTimeout");"number"===$.type(e)?e*=1e3:e=config.SPEAK_APPLY_TIMEOUT_BJY,eventEmitter.trigger(eventEmitter.SPEAK_START_TRIGGER,{timeout:e})}},onHandupEndTap:function(e){info.confirm({content:language.CONFIRM_END_SPEAK}).done(function(){var e=store.get("user");userSpeak.stopSpeak(e.id)})},cancelHandup:function(){var e=this.data.statusConfig;eventEmitter.trigger(eventEmitter.SPEAK_CANCEL_TRIGGER),this.setData({status:e.NOT_HANDUP,wrapperClass:""})},onHandupTap:function(e){var t=this,a=t.data.statusConfig,n=t.data.status;n==a.NOT_HANDUP?(t.handleApply(),t.setData({status:a.WAITING_RES,wrapperClass:"waiting"})):n==a.WAITING_RES&&t.cancelHandup()}}});