var pageSize,util=require("../../util"),eventEmitter=require("../../eventEmitter"),emotionData=require("../../data/emotion"),compressImage=require("../../function/compressImage"),$=require("../../jquery");$.extend(eventEmitter,require("./eventEmitter"));var defaultOptions={rowPerPage:4,imgWidth:32,imgHeight:32,emotionPerRow:8},emptyEmotion={name:"emptyFill",key:"emptyFill"};function fillArrayLength(e,t,r){var a=t-e.length;if(a>0)for(var i=a;i>0;)e.push(r),i--;return e}function createEmptyRow(e){for(var t=[],r=0;r<e;r++)t.push(emptyEmotion);return t}Component({properties:{emotionData:{type:"array",value:function(){return util.copy(store.get("partner.customExpression"))||[]},observer:function(e,t){this.computeAllData()}},rowPerPage:{type:"number",value:defaultOptions.rowPerPage},emotionPerRow:{type:"number",value:defaultOptions.emotionPerRow},imgWidth:{type:"number",value:defaultOptions.imgWidth},imgHeight:{type:"number",value:defaultOptions.imgHeight},showImgName:{type:"boolean",value:!1}},data:{allPageData:[]},methods:{imgTap:function(e){var t=e.target.dataset;t.stringify=emotionData.stringify(t.key),eventEmitter.trigger(eventEmitter.EMOTION_SEND,t),this.triggerEvent("emotionTap",t)},computeAllData:function(){var e=this.data;pageSize=e.rowPerPage*e.emotionPerRow;for(var t=Math.ceil(e.emotionData.length/pageSize),r=[],a=1;a<=t;a++)r.push(this.getPageData(a));this.setData({allPageData:r})},getPageData:function(e){for(var t,r=[],a=this.data,i=(e-1)*pageSize,o=a.emotionData.slice(i,i+pageSize),n=a.emotionPerRow,m=[],g=0;t=o[g++];)t.src=compressImage({url:t.url,width:this.data.imgWidth,height:this.data.imgHeight}),m.push(t),g%n==0&&(r.push(m),m=[]);return m.length>0&&(fillArrayLength(m,a.emotionPerRow,emptyEmotion),r.push(m)),r.length<a.rowPerPage&&fillArrayLength(r,a.rowPerPage,createEmptyRow(a.emotionPerRow)),r}},ready:function(){}});