var eventEmitter=require("../../eventEmitter"),appLanguage=require("../../language/main")(),pageLanguage=require("./language/main")(),store=require("../../store"),auth=require("../../auth");Object.assign(pageLanguage,appLanguage);const namespace=".lottery";let messageCommand="";Component({properties:{forceHideBox:{type:Boolean,value:!1}},data:{zoomAnimation:{},minifyAnimation:{},hasBoxClicked:!1,showBox:!1,showList:!1,duration:"",lotteryList:[],lotteryName:"",language:pageLanguage},methods:{onLotteryBoxTap:function(t){this.setData({hasBoxClicked:!0}),eventEmitter.trigger(eventEmitter.LOTTERY_BOX_CLICKED,{command:messageCommand})},onLotteryCloseTap:function(t){this.animation.opacity(0).step({duration:400}),this.setData({minifyAnimation:this.animation.export()}),setTimeout(()=>{this.setData({showList:!1,minifyAnimation:{}})},400)},startBoxAnimation:function(t){messageCommand=t.command,this.setData({showBox:!0,showList:!1,hasBoxClicked:!1});let e=!0;const a=setInterval(()=>{this.data.hasBoxClicked&&(clearInterval(a),e=!1),this.animation.opacity(e?.4:1).step(),e=!e,this.setData({zoomAnimation:this.animation.export()})},600)},showLotteryList:function(t){this.data.lotteryList&&this.setData({lotteryList:[],showList:!1}),wx.nextTick(()=>{this.setData({lotteryList:t.hitList,lotteryName:t.lotteryName,showList:!0,showBox:!1})})}},ready:function(){this.animation=wx.createAnimation({duration:600,transformOrigin:"50% 50% 0"}),eventEmitter.on(eventEmitter.COMMAND_LOTTERY_ABORT+namespace,(t,e)=>{this.showLotteryList(e)}).on(eventEmitter.STANDARD_LOTTERY_END+namespace,(t,e)=>{this.showLotteryList(e)}).on(eventEmitter.COMMAND_LOTTERY_BEIGIN+namespace,(t,e)=>{this.startBoxAnimation(e)}).on(eventEmitter.COMMAND_LOTTERY_STATUS_RES+namespace,(t,e)=>{-1!=e.duration&&auth.isStudent()&&this.startBoxAnimation(e)}).on(eventEmitter.MESSAGE_RECEIVE+namespace,function(t,e){messageCommand===e.content&&store.get("user.number")==e.from.number&&auth.isStudent()&&eventEmitter.trigger(eventEmitter.COMMAND_LOTTERY_HIT_REQ)}).on(eventEmitter.COMMAND_LOTTERY_HIT_RES+namespace,function(t,e){wx.showToast({title:pageLanguage.LOTTERY_COMMAND_CORRECT})}),setTimeout(function(){eventEmitter.trigger(eventEmitter.COMMAND_LOTTERY_STATUS_REQ)},2e3)}});