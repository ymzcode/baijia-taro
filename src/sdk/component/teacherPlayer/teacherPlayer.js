var eventEmitter=require("../../eventEmitter"),userData=require("../../data/user"),store=require("../../store"),info=require("../../info"),$=require("../../jquery"),auth=require("../../auth"),webrtcMixMediaPublish=require("../../function/webrtcMixMediaPublish"),language=require("../../language/main")(),hasTiped=!1;$.extend(language,require("./language/main")()),Component({properties:{showName:{type:Boolean,value:!0},styleInfo:{type:Object,value:{fontSize:12}},stopPlay:{type:Boolean,value:!1},orientation:{type:String,value:"vertical"},objectFit:{type:String,value:"contain"},fullScreen:{type:Boolean,value:!1},coverImage:{type:String,value:"../player/image/closeCamera.png"}},data:{userInfo:{}},ready:function(){console.log("ready teacherPlayer");var e=this;hasTiped=!1,eventEmitter.one(eventEmitter.INTERFACE_FETCH_SUCCESS,function(){auth.isWebRTC()?(console.log("bindEvents"),eventEmitter.on(eventEmitter.WEBRTC_MIX_MEDIA_PUBLISH,function(t,n){e.setUser(n.user)}).on(eventEmitter.CLASS_START,function(){}).on(eventEmitter.CLASS_END,function(){}).on(eventEmitter.PRESENTER_CHANGE,function(){webrtcMixMediaPublish()}).on(eventEmitter.MEDIA_PUBLISH,function(e,t){webrtcMixMediaPublish()}).on(eventEmitter.MEDIA_REPUBLISH,function(e,t){webrtcMixMediaPublish()}).on(eventEmitter.VIEW_RENDER_TRIGGER,function(){}),store.set("webrtcMixUser.name",language.USER_ROLE_TEACHER),wx.nextTick(webrtcMixMediaPublish)):eventEmitter.on(eventEmitter.MEDIA_PUBLISH,function(t,n){console.log("media_publish");var i=n.user;auth.isTeacher(i.type)&&e.setUser(i)}).on(eventEmitter.USER_UPDATE_RES,function(t,n){var i=n.user;auth.isTeacher(i.type)&&e.setUser(i)}).on(eventEmitter.MEDIA_REPUBLISH,function(t,n){var i=n.user;auth.isTeacher(i.type)&&e.setUser(i)}).on(eventEmitter.USER_OUT,function(t,n){var i=n.user;auth.isTeacher(i.type)&&(i.audioOn=!1,i.videoOn=!1,i.name="",i.canPlay=!userData.isAudioSpeex(i)||auth.isWebRTC(),e.setUser(i))})})},methods:{onPlayerTap:function(e){console.log("on teacher player tap");this.triggerEvent("teacherPlayerTap",e.detail)},onPlayerAVStatusChange:function(e){var t=e.detail.changeInfo,n="";console.log("onPlayerAVStatusChange",t),!0===t.audioTo&&hasTiped&&(n=language.TEACHER_OPEN_AUDIO),!1===t.audioTo&&(n=language.TEACHER_CLOSE_AUDIO),!1===t.videoTo&&hasTiped&&(n=language.TEACHER_CLOSE_VIDEO),!0===t.videoTo&&(n=language.TEACHER_OPEN_VIDEO),n&&info.tip(n),hasTiped||(hasTiped=!0),this.triggerEvent("AVStatusChange",e.detail)},onSupportedChanged:function(e){this.triggerEvent("isSupportedChanged",e.detail)},onStateChange:function(e){this.triggerEvent("stateChange",e.detail)},onNetStatus:function(e){this.triggerEvent("netStatus",e.detail)},setUser:function(e){this.setData({userInfo:e}),this.triggerEvent("setUserInfo",{user:e})}}});