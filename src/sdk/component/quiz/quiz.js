var $=require("../../jquery"),store=require("../../store"),config=require("../../config"),roomServer=require("../../server/room"),eventEmitter=require("../../eventEmitter");Component({properties:{answerDisplayTime:{type:Number,value:3e4}},data:{showQuiz:!1,url:""},methods:{msgHandler:function(e){roomServer.submitQuiz(e.detail.data[0])},getUrl:function(e,t){var r=[];return $.each(t,function(e,t){r.push(e+"="+t)}),encodeURI(e+"?"+r.join("&"))}},ready:function(){var e,t=this,r=getCurrentPages()[0],n="/"+t.getUrl(r.route,r.options);t.namespace=".quiz"+Math.random(),eventEmitter.on(eventEmitter.CLASSROOM_CONNECT_SUCCESS+t.namespace,function(){var r=store.get("env","");e=t.getUrl(config["QUIZ_PATH"+r],{env:r.replace("_",""),token:store.get("token"),room_id:store.get("class.id"),user_number:store.get("user.number"),user_name:store.get("user.name"),user_id:store.get("user.id"),from_page:encodeURIComponent(n)}),roomServer.getQuiz()}).on(eventEmitter.QUIZ_START+t.namespace,function(r,n){t.setData({url:e+"&quiz_id="+n.quizId+"#"+encodeURIComponent(JSON.stringify(n))}),t.triggerEvent("openQuiz")}).on(eventEmitter.QUIZ_END+t.namespace,function(){t.setData({url:""}),t.triggerEvent("closeQuiz")}).on(eventEmitter.QUIZ_RES+t.namespace,function(r,n){n.forceJoin&&n.quizId&&!n.endFlag&&$.isEmptyObject(n.solution)&&(t.setData({url:e+"&quiz_id="+n.quizId+"#"+encodeURIComponent(JSON.stringify(n))}),t.triggerEvent("openQuiz"))}).on(eventEmitter.COMMAND_RECEIVE,function(e,r){"quiz_submit_end"===r.command.key&&r.fromId===store.get("user.id")&&t.setData({url:""}),t.triggerEvent("closeQuiz")}).on(eventEmitter.QUIZ_SOLUTION+t.namespace,function(r,n){var i=t.data.answerDisplayTime;i>0&&(n.answerDisplayTime=i/1e3,t.setData({url:e+"&quiz_id="+n.quizId+"#"+encodeURIComponent(JSON.stringify(n))}),t.triggerEvent("openQuiz"),setTimeout(function(){t.setData({url:""}),t.triggerEvent("closeQuiz")},i))})},beforeDestroy:function(){eventEmitter.off(this.namespace)}});