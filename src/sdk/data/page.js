var $=require("../jquery"),auth=require("../auth"),eventEmitter=require("../eventEmitter"),docData=require("./doc"),serverPage=0,serverStep=0,clientPage=0,clientStep=0,maxPage=0,maxStep=0;exports.init=function(e){eventEmitter.on(eventEmitter.SERVER_PAGE_CHANGE,function(e,t){var r=docData.getSimplePage(t.docId,t.page).page;serverPage=clientPage=r,serverStep=clientStep=t.step}).on(eventEmitter.CLIENT_PAGE_CHANGE,function(e,t){var r=docData.getSimplePage(t.docId,t.page).page;clientPage=r,clientStep=t.step}).on(eventEmitter.MAX_PAGE_CHANGE,function(e,t){maxPage=t.page,maxStep=t.step})},exports.hasPrevPage=function(e){return e>0},exports.hasNextPage=function(e){return auth.canServerPage()?e<docData.getWhiteboardCount()+docData.getDocumentCount()-1:e<serverPage},exports.prevPage=function(){if(exports.hasPrevPage(clientPage))return clientPage--,!0},exports.nextPage=function(){if(exports.hasNextPage(clientPage))return clientPage++,!0},exports.getClientPage=function(){return clientPage},exports.getClientStep=function(){return clientStep},exports.getServerPage=function(){return serverPage},exports.getServerStep=function(){return serverStep},exports.getMaxPage=function(){return maxPage},exports.getMaxStep=function(){return maxStep},exports.getPageList=function(e){var t=docData.getComplexPage(e),r=t.page,a=t.docId,n=[];return $.each(docData.getRawDocList(),function(e,t){var g=t.id,i=t.pageList;if(g==a)var o=r+1;else o=i.length;for(var p=0;p<o;p++){var c=i[p];c.page=docData.getSimplePage(g,p).page,n.push(c)}}),n};